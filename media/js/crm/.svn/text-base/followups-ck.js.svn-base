function Followups(){}Followups.prototype={table_ajax_request:null,$loader:null,$tbody:null,$pagination:null,$first_paging_button:null,$current_paging_button:null,selected_date_start:"",selected_date_end:"",delete_id:0,_init:function(){$.uniform.restore("select");this.binds()},binds:function(){var e=this;e.$loader=$("#table_loader");e.$tbody=$("#tbody");e.$pagination=$("#pagination_container");e.$current_paging_button=$(".dataTables_paginate a:eq(0)");e.$first_paging_button=e.$current_paging_button;$(".page_button").live("click",function(t){e.$current_paging_button=$(this);t.preventDefault();e.refresh_table($(this))});$("#clear_filter_button").live("click",function(t){$(this).hide();$(".sb_datepicker").each(function(){$(this).val("")});e.selected_date_start="";e.selected_date_end="";e.refresh_table(e.$current_paging_button)});$(".sb_datepicker").live("change",function(t){$(this).attr("id")=="date_start"?e.selected_date_start=$(this).val():$(this).attr("id")=="date_end"&&(e.selected_date_end=$(this).val());var n=$("#clear_filter_button");n.is(":hidden")&&n.show();e.refresh_table(e.$current_paging_button)});$(document).on("submit","form#edit_followup",function(t){var n=$(this).serialize();$.post("/ajax_followup_update",n,function(t){if(t.errors!=undefined){if(t.errors.length>0){var n=t.errors.join("<br />");$.jGrowl(n,{theme:"error",sticky:!1})}}else $.jGrowl("Followup successfully updated.",{theme:"success",sticky:!1});e.refresh_table(e.$current_paging_button)},"json");t.preventDefault();e.refresh_table(e.$current_paging_button)});$(document).on("click",".followup-update",function(t){var n=$(this).data("update-type"),r=$(this).data("id"),i="",s={};if(n=="delete"){s={id:r,deleted:1};i="Followup "+r+" deleted.";$.alert({type:"confirm",title:"Confirm Followup Deletion",text:"<p>Are you sure you want to delete followup #"+r+"?</p>",callback:function(){$.post("/ajax_followup_update",s,function(t){t.errors!=undefined?t.errors.length>0&&$.jGrowl("Oops! Something went wrong.",{theme:"error",sticky:!1}):$.jGrowl(i,{theme:"success",sticky:!1});e.refresh_table(e.$current_paging_button)},"json")}})}else if(n=="approve"){s={id:r,approved:1};i="Followup "+r+" approved.";$.post("/ajax_followup_update",s,function(t){t.errors!=undefined?t.errors.length>0&&$.jGrowl("Oops! Something went wrong.",{theme:"error",sticky:!1}):$.jGrowl(i,{theme:"success",sticky:!1});e.refresh_table(e.$current_paging_button)},"json")}t.preventDefault()});$(document).on("click",".followup-notify",function(t){var n=$(this).data("id"),r="",i={id:n};$.post("/ajax_followup_notify_support",i,function(t){if(t.errors!=undefined)t.errors.length>0&&$.jGrowl("Oops! Something went wrong.",{theme:"error",sticky:!1});else{r="Followup "+n+" flagged. Support has been emailed.";$.jGrowl(r,{theme:"success",sticky:!1})}e.refresh_table(e.$current_paging_button)},"json");t.preventDefault()});e.refresh_table(e.$current_paging_button)},refresh_table:function(e){var t=this;if($sb.empty(e))return!1;var n=e.attr("data-page_number");n||(n="1");if(!$sb.empty(n)){t.table_ajax_request!=null&&t.table_ajax_request.abort();t.show_loader();t.table_ajax_request=$.getJSON("/report_followups/"+n,{date_start:t.selected_date_start,date_end:t.selected_date_end},function(e){t.table_ajax_request=null;typeof e.html.results!="undefined"&&t.$tbody.html(e.html.results);typeof e.html.pagination!="undefined"&&t.$pagination.html(e.html.pagination);t.hide_loader()})}},show_loader:function(){var e=this;e.$loader.show();e.$tbody.addClass("loading")},hide_loader:function(){var e=this;e.$tbody.removeClass("loading");e.$loader.hide()}};$sb.crm.Followups=new Followups;$(document).ready(function(){$sb.crm.Followups._init();$(".dialog-open-btn").tabbed_dialog({target:"#dialog_placeholder",title_pattern:"Followup #[id]",tabs:[{request:"ajax_followup_view/[id]",title:"Details"}]})});