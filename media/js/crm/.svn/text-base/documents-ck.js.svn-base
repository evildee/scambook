function Transactions(){}Transactions.prototype={table_ajax_request:null,filter_query:"",filter_file_type:"",filter_from_date:"",filter_to_date:"",$filter_query:null,$filter_file_type:null,$filter_from_date:null,$filter_to_date:null,current_sort_field:"company_documents.uploaded",current_sort_order:"desc",$loader:null,$tbody:null,$pagination:null,$current_paging_button:null,$first_paging_button:null,edit_document_dialog:null,current_edit_document_id:0,_init:function(){this.binds()},binds:function(){var e=this;e.$filter_query=$("#filter_query");e.$filter_file_type=$("#filter_file_type");e.$filter_from_date=$("#filter_from_date");e.$filter_to_date=$("#filter_to_date");e.$loader=$("#table_loader");e.$tbody=$("#documents_tbody");e.$pagination=$("#pagination_container");e.$current_paging_button=$(".dataTables_paginate a:eq(0)");e.$first_paging_button=e.$current_paging_button;e.$filter_query.keyup(function(t){e.filter_query=t.target.value;e.refresh_documents(e.$first_paging_button)});$("#filter_from_date, #filter_to_date, #filter_file_type").live("change",function(t){t.target.id==="filter_file_type"?e.filter_file_type=t.target.value:t.target.id==="filter_from_date"?e.filter_from_date=t.target.value:t.target.id==="filter_to_date"&&(e.filter_to_date=t.target.value);e.refresh_documents(e.$first_paging_button)});$(".page_button").live("click",function(t){e.$current_paging_button=$(this);t.preventDefault();e.refresh_documents(e.$current_paging_button)});e.edit_document_dialog=$("#edit_document_dialog").dialog({autoOpen:!1,width:475,height:280,resizable:!1,buttons:{Save:function(){var t=$("#edit_document_title").val(),n=$("#edit_document_description").val();if(!t)return;$sb.ajax.post("/edit_document",{id:e.current_edit_document_id,title:t,description:n},function(t){e.refresh_documents(e.$current_paging_button);$("#edit_document_status").html('<span class="ticket ticket-success">Saved...</span>').show().delay(1500).queue(function(e){$(this).hide();e()})})},Close:function(){$(this).dialog("close")}},open:function(){$("#edit_document_dialog").next(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").children('button:contains("Save")').attr("disabled",!0).addClass("ui-state-disabled");$("#edit_document_dialog").dialog("option","title","Loading...");$("#edit_document_title, #edit_document_description").attr("disabled",!0);$sb.ajax.get("/get_document",{document:e.current_edit_document_id},function(e){if(e.data.error===""){$("#edit_document_title").val(e.data.document.title);$("#edit_document_description").val(e.data.document.description);$("#edit_document_title, #edit_document_description").removeAttr("disabled");$("#edit_document_dialog").dialog("option","title",'Edit Document "'+e.data.document.title_short+'"');$("#edit_document_dialog").next(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").children('button:contains("Save")').removeAttr("disabled").removeClass("ui-state-disabled")}})},close:function(){e.current_edit_document_id=0;$("#edit_document_title, #edit_document_description").val("")}});$("#documents_table .edit").live("click",function(){e.current_edit_document_id=$(this).attr("data-document_id");e.edit_document_dialog.dialog("open")});$("#documents_table .delete").live("click",function(){var t=$(this),n=t.attr("data-document_filename"),r=t.attr("data-document_id");$.alert({type:"confirm",title:"Set As Printed?",text:'<p>Are you sure you want to delete the document "'+n+'"?</p>',callback:function(){t.replaceWith("Deleting...");$sb.ajax.post("/delete_document",{document:r},function(t){e.refresh_documents(e.$current_paging_button)})}})});$(".sortable-th").live("click",function(){var t=$(this).attr("data-sort");if(t===e.current_sort_field)e.current_sort_order=e.current_sort_order==="asc"?"desc":"asc";else{e.current_sort_order="asc";$("#"+e.current_sort_field+"_sort_icon").addClass("hidden");$("#"+t+"_sort_icon").removeClass("hidden")}$("#"+e.current_sort_field+"_th").removeClass("active");$(".icon").not("#"+t+"_sort_icon").removeClass("active");e.current_sort_field=t;var n=$("#"+t+"_sort_icon");$("#"+t+"_th").addClass("active");n.addClass("active");if(e.current_sort_order==="asc"){n.removeClass("desc");n.addClass("asc")}else{n.removeClass("asc");n.addClass("desc")}e.refresh_documents(e.$first_paging_button)});e.refresh_documents(e.$first_paging_button)},refresh_documents:function(e){var t=this;if($sb.empty(e))return;var n=e.attr("data-page_number")?e.attr("data-page_number"):"1";if(!$sb.empty(n)){t.table_ajax_request!==null&&t.table_ajax_request.abort();t.$loader.show();t.$tbody.html('<tr><td id="documents_table_loader" colspan="6"></td></tr>');t.table_ajax_request=$.getJSON("/documents/"+n,{query:t.filter_query,file_type:t.filter_file_type,from_date:t.filter_from_date,to_date:t.filter_to_date,sort_field:t.current_sort_field,sort_order:t.current_sort_order},function(e){t.table_ajax_request=null;if(e.html.data.num_documents>0){typeof e.html.results!="undefined"&&t.$tbody.html(e.html.results);typeof e.html.pagination!="undefined"&&t.$pagination.html(e.html.pagination)}else t.$tbody.html('<tr><td colspan="6" id="no_documents"><span id="no_results">No documents found.</span></td></tr>');t.$loader.hide()})}}};$sb.crm.Transactions=new Transactions;$(document).ready(function(){$sb.crm.Transactions._init()});