function Transactions(){}Transactions.prototype={table_ajax_request:null,filter_query:"",filter_query_what:"stripe_customer",filter_from_date:"",filter_to_date:"",filter_type:"",filter_plan:"",$filter_query:null,$filter_from_date:null,$filter_to_date:null,$filter_plan:null,$tbody:null,$pagination:null,$current_paging_button:null,$first_paging_button:null,_init:function(){this.binds()},binds:function(){var e=this;e.$filter_query=$("#filter_query");e.$filter_from_date=$("#filter_from_date");e.$filter_to_date=$("#filter_to_date");e.$filter_plan=$("#filter_plan");e.$tbody=$("#transactions_tbody");e.$pagination=$("#pagination_container");e.$current_paging_button=$(".dataTables_paginate a:eq(0)");e.$first_paging_button=e.$current_paging_button;$("#filter_form").submit(function(){e.filter_query=e.$filter_query.val();e.filter_from_date=e.$filter_from_date.val();e.filter_to_date=e.$filter_to_date.val();e.refresh_transactions(e.$current_paging_button);return!1});e.$filter_query.keyup(function(t){e.filter_query=t.target.value;e.refresh_transactions(e.$first_paging_button)});$("#filter_from_date, #filter_to_date").live("change",function(t){t.target.id==="filter_from_date"?e.filter_from_date=t.target.value:t.target.id==="filter_to_date"&&(e.filter_to_date=t.target.value);e.refresh_transactions(e.$first_paging_button)});e.$filter_plan.change(function(t){e.filter_plan=t.target.value;e.refresh_transactions(e.$first_paging_button)});$('input[name="query_what"]').change(function(t){e.filter_query_what=t.target.value;var n="Search for {0}...";e.filter_query_what==="stripe_customer"?$("#filter_query").attr("placeholder",n.replace("{0}","Stripe Customer ID")):e.filter_query_what==="user_account"?$("#filter_query").attr("placeholder",n.replace("{0}","User Account ID")):e.filter_query_what==="business_account"&&$("#filter_query").attr("placeholder",n.replace("{0}","Business Account ID"))});$('input[name="filter_type"]').change(function(t){e.filter_type=t.target.value;e.refresh_transactions(e.$first_paging_button)});$('input[name="query_what"]').change(function(t){e.filter_query_what=t.target.value;e.refresh_transactions(e.$first_paging_button)});$(".page_button").live("click",function(t){e.$current_paging_button=$(this);t.preventDefault();e.refresh_transactions(e.$current_paging_button)});$(document).on("submit","form#refund_transaction",function(t){var n=$(this).serialize(),r=$(this).find("input[type='submit']");r.val("Working...");$(this).find("input").each(function(){$(this).attr("disabled",!0)});e.refund(n);t.preventDefault()});e.refresh_transactions(e.$first_paging_button)},refresh_transactions:function(e){var t=this;if($sb.empty(e))return;var n=e.attr("data-page_number")?e.attr("data-page_number"):"1";t.table_ajax_request!==null&&t.table_ajax_request.abort();t.$tbody.html('<tr><td id="transactions_table_loader" colspan="4"></td></tr>');t.table_ajax_request=$.getJSON("/get_transactions/"+n,{query:t.filter_query,query_what:t.filter_query_what,from_date:t.filter_from_date,to_date:t.filter_to_date,type:t.filter_type,plan:t.filter_plan},function(e){t.$tbody.html(e.data.html);t.$pagination.html(e.data.pagination)})},refund:function(e){var t=this;$.post("/refund_transaction",e,function(e){if(e.errors!=undefined){if(e.errors.length>0){var n=e.errors.join("<br />");$("form#refund_transaction input[type='submit']").val("Submit");$("form#refund_transaction").find("input").each(function(){$(this).attr("disabled",!1)});$.jGrowl(n,{theme:"error",sticky:!1})}}else{$("#dialog_placeholder").dialog("close");$.jGrowl("Refunding...",{theme:"success",sticky:!1});t.refresh_transactions(t.$current_paging_button)}},"json")}};$sb.crm.Transactions=new Transactions;$(document).ready(function(){$sb.crm.Transactions._init();$(".dialog-open-btn").tabbed_dialog({target:"#dialog_placeholder",title_pattern:"Transaction #[id]",tabs:[{request:"refund_transaction/[id]",title:"Refund"}]})});