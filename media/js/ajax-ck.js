// requires: jquery
function ajax(){}ajax.prototype={_inst:Object,_debug:!1,_error:!1,url:null,data:null,form:null,mode:"GET",data_type:"json",success:null,error:null,async:!0,cache:!1,cross_domain:!1,before:null,after:null,timeout:1e4,debug_mode:"debug",response:null,show_error:!1,auto_submit:function(e){var t=$(e).serialize(),n=$(e).attr("action"),r="post";typeof $(e).attr("method")!="undefined"&&($(e).attr("method")=="GET"||$(e).attr("method")=="get")&&(r="get");var i=this;i.before=function(){$sb.ui.lock_element(e);$(e).find('input[type="submit"]').attr("disabled","disabled")};i.complete=function(){$sb.ui.unlock_element(e);$(e).find('input[type="submit"]').removeAttr("disabled")};r=="post"?i.post(n,t,function(e){}):i.get(n,t,function(e){})},get:function(e,t,n){this.mode="GET";this.url=e;this.data=t;this.success=n;this._ajax()},post:function(e,t,n){this.mode="POST";this.url=e;this.data=t;this.success=n;this._ajax()},_ajax:function(){var e=this,t=this;e._remove_validation();typeof this.before!="function"&&(this.before=function(){});$.ajax({url:this.url,type:this.mode,data:this.data,cache:this.cache,dataType:this.data_type,beforeSend:this.before(),success:function(n){if($sb.empty(n))return!1;e.response=n;typeof n.validation!="undefined"&&!$sb.empty(n.validation)&&e._validation(n.validation);typeof n.profiler!="undefined"&&!$sb.empty(n.profiler)&&e._write_profiler(n.profiler);if(typeof n.success!="undefined"&&n.success){typeof n.redirect!="undefined"&&e._redirect(n.redirect);if(typeof n.actions!="undefined")for(var r=0;r<n.actions.length;r++)e._action(n.actions[r]);typeof e.success!="undefined"&&e.success(n);if(typeof n.successes!="undefined")for(var i=0;i<n.successes.length;i++)$sb.show_success(n.successes[i]);if(typeof n.errors!="undefined")for(var i=0;i<n.errors.length;i++)$sb.show_error(n.errors[i]);typeof n.callback!="undefined"&&t._callback(n.callback)}},complete:function(){$sb.binds();typeof e.complete=="function"&&e.complete()},error:function(n,r,i){if(t.show_error){$sb.show_error("Sorry. We could not complete your request");$sb.log("ajax request failed or could not be parsed");$sb.empty(e.error)||e.error(n,r,i)}}})},_callback:function(e){try{var t=window[e];typeof t=="function"&&t()}catch(n){$sb.log(n)}},_redirect:function(e){$sb.empty(e)||(window.location=e)},_remove_validation:function(){try{typeof $.fn.qtip!="undefined"&&$(".validation_error").qtip("destroy")}catch(e){}$(".validation_error").removeClass("validation_error")},_set_validation_input_class:function(e){$(e).addClass("validation_error")},_action:function(e){if(typeof e.selector=="undefined")return!1;var t=e.selector;if(typeof e.content!="undefined")var n=e.content;else var n="";var r=$(t);if(typeof e.method=="undefined")return!1;switch(e.method){case"append":$(r).append(n);break;case"prepend":$(r).prepend(n);break;case"replaceWith":$(r).replaceWith(n);break;case"remove":$(r).remove();break;case"empty":$(r).empty();break;case"html":$(r).html(n);break;case"fadeIn":$(r).fadeIn(n,200);break;case"fadeOut":$(r).fadeOut(200);break;case"slideOutLeft":$(r).hide("slide",{direction:"left"},200);break;case"slideInRight":$(r).show("slide",{direction:"right"},200);break;case"slideLeftReplace":$(r).hide("slide",{direction:"left"},200,function(){$(n).show("slide",{direction:"right"},200)});break;case"fadeOutFadeIn":$(r).fadeOut(200,function(){$(n).fadeIn(400)});break;case"hideShow":$(r).hide();$(n).show();break;case"replaceHref":$(r).attr("href",n);break;case"text":$(r).text(n);break;case"before":$(r).before(n)}},_set_validation_tooltip:function(e,t){if($(t).is(":hidden"))return;var n=$(t),r=["top right","left bottom"],i=n.parents("span.right").length>0;if(typeof $(t).data("position")!="undefined")switch($(t).data("position")){case"top-left":r=["top left","right bottom"];break;case"bottom-left":r=["bottom left","right bottom"]}var s={my:r[i?0:1],at:r[i?1:0],viewport:$(window)};n.parents("span.left-side").length>0&&(s={my:"right top",at:"left top"});$sb.empty(e)?n.qtip("destroy"):n.qtip({overwrite:!1,content:e,position:s,show:{event:!1,ready:!0},hide:!1,style:{classes:"ui-tooltip-red"}}).qtip("option","content.text",e)},_validation:function(e){if(!$sb.empty(e))for(var t=0;t<e.length;t++){var n=e[t].name,r=$('[name="'+n+'"]:visible');if(typeof $(r).data("validation_target")!="undefined"){var i=$($(r).data("validation_target"));i.length&&(r=i)}if(!$sb.empty(r)){this._set_validation_input_class(r);if(!$sb.empty(e[t].message)){var s="";for(m=0;m<e[t].message.length;m++)!$sb.empty(e[t].message[m])&&e[t].message[m]&&(s+=e[t].message[m]);this._set_validation_tooltip(s,r)}}}},_write_profiler:function(e){$("#kohana-profiler").empty();$("#kohana-profiler").append(e)}};$sb.ajax=new ajax;